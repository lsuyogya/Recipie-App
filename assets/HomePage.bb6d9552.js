import{_ as S,k as y,m as Q,o as q,S as C,R as O,l as x,r as g,j as f,a as M,F as w,b as E}from"./index.7aa4dafd.js";import{Q as N,u as _,a as H,b as D}from"./card.2fd406bf.js";import{M as R,S as F}from"./Searchbar.6cece26a.js";var U=function(c){S(d,c);function d(u,r){var e;return e=c.call(this)||this,e.client=u,e.queries=[],e.result=[],e.observers=[],e.observersMap={},r&&e.setQueries(r),e}var s=d.prototype;return s.onSubscribe=function(){var r=this;this.listeners.length===1&&this.observers.forEach(function(e){e.subscribe(function(a){r.onUpdate(e,a)})})},s.onUnsubscribe=function(){this.listeners.length||this.destroy()},s.destroy=function(){this.listeners=[],this.observers.forEach(function(r){r.destroy()})},s.setQueries=function(r,e){this.queries=r,this.updateObservers(e)},s.getCurrentResult=function(){return this.result},s.getOptimisticResult=function(r){return this.findMatchingObservers(r).map(function(e){return e.observer.getOptimisticResult(e.defaultedQueryOptions)})},s.findMatchingObservers=function(r){var e=this,a=this.observers,i=r.map(function(n){return e.client.defaultQueryObserverOptions(n)}),o=i.flatMap(function(n){var h=a.find(function(m){return m.options.queryHash===n.queryHash});return h!=null?[{defaultedQueryOptions:n,observer:h}]:[]}),v=o.map(function(n){return n.defaultedQueryOptions.queryHash}),l=i.filter(function(n){return!v.includes(n.queryHash)}),p=a.filter(function(n){return!o.some(function(h){return h.observer===n})}),t=l.map(function(n,h){if(n.keepPreviousData){var m=p[h];if(m!==void 0)return{defaultedQueryOptions:n,observer:m}}return{defaultedQueryOptions:n,observer:e.getObserver(n)}}),b=function(h,m){return i.indexOf(h.defaultedQueryOptions)-i.indexOf(m.defaultedQueryOptions)};return o.concat(t).sort(b)},s.getObserver=function(r){var e=this.client.defaultQueryObserverOptions(r),a=this.observersMap[e.queryHash];return a!=null?a:new N(this.client,e)},s.updateObservers=function(r){var e=this;y.batch(function(){var a=e.observers,i=e.findMatchingObservers(e.queries);i.forEach(function(t){return t.observer.setOptions(t.defaultedQueryOptions,r)});var o=i.map(function(t){return t.observer}),v=Object.fromEntries(o.map(function(t){return[t.options.queryHash,t]})),l=o.map(function(t){return t.getCurrentResult()}),p=o.some(function(t,b){return t!==a[b]});a.length===o.length&&!p||(e.observers=o,e.observersMap=v,e.result=l,e.hasListeners()&&(Q(a,o).forEach(function(t){t.destroy()}),Q(o,a).forEach(function(t){t.subscribe(function(b){e.onUpdate(t,b)})}),e.notify()))})},s.onUpdate=function(r,e){var a=this.observers.indexOf(r);a!==-1&&(this.result=q(this.result,a,e),this.notify())},s.notify=function(){var r=this;y.batch(function(){r.listeners.forEach(function(e){e(r.result)})})},d}(C);function L(c){var d=O.useRef(!1),s=O.useState(0),u=s[1],r=x(),e=g.exports.useMemo(function(){return c.map(function(v){var l=r.defaultQueryObserverOptions(v);return l.optimisticResults=!0,l})},[c,r]),a=O.useState(function(){return new U(r,e)}),i=a[0],o=i.getOptimisticResult(e);return O.useEffect(function(){d.current=!0;var v=i.subscribe(y.batchCalls(function(){d.current&&u(function(l){return l+1})}));return function(){d.current=!1,v()}},[i]),O.useEffect(function(){i.setQueries(e,{listeners:!1})},[e,i]),o}const j=({data:c})=>{var d;return f("div",{className:"card-container",children:(d=c==null?void 0:c.data.meals)==null?void 0:d.map(s=>f(R,{meal:s},s.idMeal))})},A=()=>{const[c,d]=g.exports.useState(void 0),[s,u]=g.exports.useState([Math.random(),Math.random(),Math.random()]),r={queryFn:H,refetchOnWindowFocus:!1,staleTime:1/0},e=L([{queryKey:["getData",s[0]],...r},{queryKey:["getData",s[1]],...r},{queryKey:["getData",s[2]],...r}]),i=_({queryKey:["searchData",c],...{queryFn:()=>D(c),refetchOnWindowFocus:!1,staleTime:1/0},enabled:!!c}),o=t=>{d(t.target.value)},v=(t,b)=>{let n;return(...h)=>{clearTimeout(n),n=setTimeout(()=>{t(...h)},b)}},l=()=>{u([Math.random(),Math.random(),Math.random()])},p=e.some(t=>t.isLoading)||i.isLoading;return M(w,{children:[M("section",{className:"top-bar",children:[f("button",{onClick:l,children:"Random"}),f(F,{onChange:v(o,400)})]}),p?f(E,{}):i.isFetched?i.data.data.meals===null?f("main",{className:"card-holder",children:f("div",{className:"card-container",children:f("div",{className:"card",children:"Search Result Not found"})})}):f("main",{className:"card-holder",children:i.data.data.meals.map(t=>f("div",{className:"card-container",children:f(R,{meal:t})}))}):f("main",{className:"card-holder",children:e.map((t,b)=>f(j,{data:t.data},b))})]})};export{A as default};
